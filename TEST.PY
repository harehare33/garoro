import tkinter as tk
import tkinter.font as tkfont
import re

# --- split_by_punctuation í•¨ìˆ˜ëŠ” ì´ì „ ë²„ì „ ê·¸ëŒ€ë¡œ ë‘ì„¸ìš” ---
# (ì´ì „ ë‹µë³€ì—ì„œ ...ì„ ì œì™¸í•˜ë„ë¡ ìˆ˜ì •í•œ ë²„ì „ ì‚¬ìš©)
def split_by_punctuation(text):
    # ... (ì´ì „ ë‹µë³€ì˜ ìµœì¢… ë²„ì „ ë‚´ìš©) ...
    if not text: return []
    result = []
    parts = re.split(r'(ã€‚|ã€|ã€|ï¼Ÿ|ï¼)', text) # ì¤„ì„í‘œ ì œì™¸
    current_sentence = ""
    i = 0
    while i < len(parts):
        part = parts[i]
        if not part: i += 1; continue
        current_sentence += part
        is_terminator = part in ['ã€‚', 'ã€', 'ã€', 'ï¼Ÿ', 'ï¼']
        is_question_or_exclamation = part in ['ï¼Ÿ', 'ï¼']
        next_part_is_closing_quote = False
        if i + 1 < len(parts):
            j = i + 1
            while j < len(parts) and not parts[j]: j += 1
            if j < len(parts) and parts[j] in ['ã€', 'ã€']:
                next_part_is_closing_quote = True
        if is_terminator and not (is_question_or_exclamation and next_part_is_closing_quote):
            cleaned_sentence = current_sentence.strip()
            if cleaned_sentence: result.append(cleaned_sentence)
            current_sentence = ""
        i += 1
    cleaned_sentence = current_sentence.strip()
    if cleaned_sentence: result.append(cleaned_sentence)
    return result
# --- split_by_punctuation í•¨ìˆ˜ ë ---


def convert_text():
    input_text = input_box.get("1.0", tk.END)

    # 1. ëª¨ë“  ì¤„ì„ ë¶™ì—¬ì„œ ë‹¨ë½ ë³µì› (â­ ìˆ«ì ì¤„ í•„í„°ë§ ì¶”ê°€)
    lines = input_text.strip().split('\n')
    paragraphs = []
    paragraph = ''

    for line in lines:
        stripped = line.strip() # ê° ì¤„ì˜ ì•ë’¤ ê³µë°± ì œê±°
        if not stripped: # ë¹ˆ ì¤„ì´ë©´ ë‹¨ë½ êµ¬ë¶„
            if paragraph:
                paragraphs.append(paragraph)
                paragraph = ''
        else:
            # â­â­â­ í•µì‹¬ ìˆ˜ì •: í˜„ì¬ ì¤„(stripped)ì´ ìˆ«ìë¡œë§Œ ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸! â­â­â­
            if not stripped.isdigit(): # ìˆ«ìë¡œë§Œ ëœ ì¤„ì´ *ì•„ë‹ˆë¼ë©´* (ì¦‰, ê¸€ìë‚˜ ê¸°í˜¸ê°€ ìˆë‹¤ë©´)
                paragraph += stripped # ê°€ë¡œ ë¬¸ì¥ì— ì´ì–´ë¶™ì„
            # else: ìˆ«ìë¡œë§Œ ëœ ì¤„ì´ë©´ ì•„ë¬´ê²ƒë„ ì•ˆ í•˜ê³  ë„˜ì–´ê° (ë¬´ì‹œ!)

    # ë§ˆì§€ë§‰ ì¤„ ì²˜ë¦¬
    if paragraph:
        paragraphs.append(paragraph)

    # 2. í•œ ë¬¸ë‹¨ì”© ì²˜ë¦¬ (ì´ì œ paragraphì—ëŠ” ìˆ«ìê°€ ì„ì—¬ìˆì§€ ì•ŠìŒ)
    result_lines = []
    for line in paragraphs: # ì´ì œ ì´ lineì€ '178ã€Œì‚¬ã€' ì´ëŸ° ì‹ì´ ì•„ë‹ˆë¼ 'ã€Œì‚¬ã€' í˜•íƒœì¼ ê²ƒì„
        line = line.strip()
        if not line:
            continue

        # (ì„ íƒì‚¬í•­) ë§¨ ì•ì˜ ìˆ«ì ì œê±° ë¡œì§ì€ ì—¬ì „íˆ ìœ ìš©í•  ìˆ˜ ìˆìœ¼ë‹ˆ ë‚¨ê²¨ë‘¡ë‹ˆë‹¤.
        # (í˜¹ì‹œ '1. ëŒ€ì‚¬' ì²˜ëŸ¼ ë¶™ì–´ìˆëŠ” ê²½ìš° ëŒ€ë¹„)
        cleaned_line = re.sub(r'^\s*\d+[\s\.]*\s*', '', line).strip()

        if not cleaned_line:
            continue

        # ğŸ”¸ SE: ë‹¨ìœ„ë¡œ ë‚˜ëˆ„ê¸° (ê¸°ì¡´ê³¼ ë™ì¼)
        if 'SE:' in cleaned_line:
            parts = re.split(r'(SE:.*?)(?=\s*SE:|$)', cleaned_line)
            for part in parts:
                part = part.strip()
                if not part:
                    continue
                if part.startswith('SE:'):
                    result_lines.append(part)
                else:
                    result_lines.extend(split_by_punctuation(part))
        else:
            # ğŸ”¹ ì¼ë°˜ ë¬¸ì¥ì€ ë¬¸ì¥ë¶€í˜¸ë¡œë§Œ ë¶„ë¦¬ (ê¸°ì¡´ê³¼ ë™ì¼)
            result_lines.extend(split_by_punctuation(cleaned_line))

    # 3. ê²°ê³¼ í•©ì¹˜ê¸°
    result = '\n'.join(result_lines)

    # ì¶œë ¥ì°½ì— ë„£ê¸°
    output_box.delete("1.0", tk.END)
    output_box.insert(tk.END, result)


def clear_input():
    input_box.delete("1.0", tk.END)
    output_box.delete("1.0", tk.END)


# --- ì´í•˜ Tkinter GUI ì„¤ì • ì½”ë“œëŠ” ë™ì¼ ---
# ... (ì°½ ì„¤ì •, í°íŠ¸, ì…ë ¥ì°½, ë²„íŠ¼, ì¶œë ¥ì°½ ì½”ë“œ) ...
# ì°½ ì„¤ì •
root = tk.Tk()
root.title("ì„¸ë¡œì“°ê¸° â†’ ê°€ë¡œì“°ê¸° ë³€í™˜ê¸°")
root.geometry("600x500")

# í°íŠ¸ ì„¤ì • (BIZ UDPã‚´ã‚·ãƒƒã‚¯ í°íŠ¸ê°€ ì—†ìœ¼ë©´ ë‹¤ë¥¸ ì¼ë³¸ì–´ ì§€ì› í°íŠ¸ë¡œ ë³€ê²½í•˜ì„¸ìš”)
try:
    custom_font = tkfont.Font(family="BIZ UDPã‚´ã‚·ãƒƒã‚¯", size=13)
except tk.TclError:
    try:
        custom_font = tkfont.Font(family="Yu Gothic", size=13) # ë‹¤ë¥¸ ì˜ˆì‹œ í°íŠ¸
    except tk.TclError:
        custom_font = tkfont.Font(size=13) # ê¸°ë³¸ í°íŠ¸

# ì…ë ¥ì°½
input_box = tk.Text(root, height=10, font=custom_font)
input_box.pack(padx=10, pady=(10, 5), fill="both", expand=True)

# ë²„íŠ¼ í”„ë ˆì„
button_frame = tk.Frame(root)
button_frame.pack(pady=5)

btn_convert = tk.Button(button_frame, text="ê°€ë¡œë¡œ ë³€í™˜", command=convert_text, width=15)
btn_convert.pack(side="left", padx=5)

btn_clear = tk.Button(button_frame, text="ì…ë ¥ ì „ì²´ ì‚­ì œ", command=clear_input, width=15)
btn_clear.pack(side="left", padx=5)

# ì¶œë ¥ì°½ + ìŠ¤í¬ë¡¤ë°”
output_frame = tk.Frame(root)
output_frame.pack(padx=10, pady=(5, 10), fill="both", expand=True)

scrollbar = tk.Scrollbar(output_frame)
scrollbar.pack(side="right", fill="y")

output_box = tk.Text(output_frame, height=10, font=custom_font, bg="#f0f0f0", wrap="word", yscrollcommand=scrollbar.set)
output_box.pack(side="left", fill="both", expand=True)
scrollbar.config(command=output_box.yview)

# ì‹¤í–‰
root.mainloop()

def clear_input():
    input_box.delete("1.0", tk.END)
    output_box.delete("1.0", tk.END)

# --- ì´í•˜ Tkinter GUI ì„¤ì • ì½”ë“œëŠ” ë™ì¼ ---
# ì°½ ì„¤ì •
root = tk.Tk()
root.title("ì„¸ë¡œì“°ê¸° â†’ ê°€ë¡œì“°ê¸° ë³€í™˜ê¸°")
root.geometry("600x500")

# í°íŠ¸ ì„¤ì • (BIZ UDPã‚´ã‚·ãƒƒã‚¯ í°íŠ¸ê°€ ì—†ìœ¼ë©´ ë‹¤ë¥¸ ì¼ë³¸ì–´ ì§€ì› í°íŠ¸ë¡œ ë³€ê²½í•˜ì„¸ìš”)
try:
    custom_font = tkfont.Font(family="BIZ UDPã‚´ã‚·ãƒƒã‚¯", size=13)
except tk.TclError:
    try:
        custom_font = tkfont.Font(family="Yu Gothic", size=13) # ë‹¤ë¥¸ ì˜ˆì‹œ í°íŠ¸
    except tk.TclError:
        custom_font = tkfont.Font(size=13) # ê¸°ë³¸ í°íŠ¸

# ì…ë ¥ì°½
input_box = tk.Text(root, height=10, font=custom_font)
input_box.pack(padx=10, pady=(10, 5), fill="both", expand=True)

# ë²„íŠ¼ í”„ë ˆì„
button_frame = tk.Frame(root)
button_frame.pack(pady=5)

btn_convert = tk.Button(button_frame, text="ê°€ë¡œë¡œ ë³€í™˜", command=convert_text, width=15)
btn_convert.pack(side="left", padx=5)

btn_clear = tk.Button(button_frame, text="ì…ë ¥ ì „ì²´ ì‚­ì œ", command=clear_input, width=15)
btn_clear.pack(side="left", padx=5)

# ì¶œë ¥ì°½ + ìŠ¤í¬ë¡¤ë°”
output_frame = tk.Frame(root)
output_frame.pack(padx=10, pady=(5, 10), fill="both", expand=True)

scrollbar = tk.Scrollbar(output_frame)
scrollbar.pack(side="right", fill="y")

output_box = tk.Text(output_frame, height=10, font=custom_font, bg="#f0f0f0", wrap="word", yscrollcommand=scrollbar.set)
output_box.pack(side="left", fill="both", expand=True)
scrollbar.config(command=output_box.yview)

# ì‹¤í–‰
root.mainloop()